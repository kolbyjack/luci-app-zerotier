stages:
  - build

build:
  stage: build
  tags:
    - docker
  image: registry.gitlab.com/kolbyhack/openwrt/builder-image
  script:
    - cd ~/openwrt
    - echo "src-link local $CI_PROJECT_DIR" >> feeds.conf
    - ./scripts/feeds update -a
    - ./scripts/feeds install -a
    - make defconfig
    - echo "CONFIG_PACKAGE_luci-app-zerotier=m" >> .config
    - grep -v '^#' .config | grep -v '^$'
    - make -j1 V=sc package/luci-app-zerotier/compile
    - make -j1 V=sc package/luci-app-zerotier/install
    - make -j1 V=sc package/index
    - find . -name '*.ipk'

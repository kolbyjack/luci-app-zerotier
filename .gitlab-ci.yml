stages:
  - build

build:
  stage: build
  tags:
    - docker
  image: openwrtorg/sdk
  script:
    - cd ~/openwrt
    - ./scripts/feeds update -a
    - echo "src-link local $CI_PROJECT_DIR" >> feeds.conf
    - ./scripts/feeds update local
    - make defconfig
    - ./scripts/feeds install luci-app-zerotier
    - grep -v '^#' .config | grep -v '^$'
    - make -j1 V=sc package/luci-app-zerotier/compile
    - find . -name '*.ipk'
    - make -j1 V=sc package/index
    - find . -name '*.ipk'

stages:
  - build

build:
  stage: build
  tags:
    - docker
  image: openwrtorg/sdk
  script:
    - cd ~/openwrt
    - echo "src-link local $CI_PROJECT_DIR" >> feeds.conf.default
    - ./scripts/feeds update -a
    - make defconfig
    - ./scripts/feeds install luci-app-zerotier
    - make package/luci-app-zerotier/compile
    - mv bin/packages/*/local/*.ipk "$CI_PROJECT_DIR"
  artifacts:
    paths:
      - "*.ipk"
